var da=new function(){function a(a){return Math.sin(6.283184*a)}var c=[a,function(a){return.5>a%1?1:-1},function(a){return a%1*2-1},function(a){a=a%1*4;return 2>a?a-1:3-a}],d,e,q,g,f;this.J=function(){var a={M:[{a:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,194,4,1,3,25,191,115,244,147,6,84,6],p:[5,1,2,1,1,1,1,3,4,1,2,1,2,1,2,,,7,8,7,8,7,8,7,8,6,9],c:[{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130],b:[21,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,,,48]},{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],b:[,,,,,,,,,,,,,,,,,,,,,,,,,,,11,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,31]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,123],b:[]},{n:[114,,,,,,,,126,,,,,,,,114,,,,,,,,114,126,111,123,114,126,118,130],b:[13,,,,,,,,,,,,,,,,,,,,,,,,13,,13,,13,,13,11,29,,,,,,,,,,,,,,,,,,,,,,,,32,,41,,29,,25,15]},{n:[123,123,135,128,123,123,135,130,126,125,126,
128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],b:[13,11,21,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,17,29,,25,113,,,,,,,,,,,,,,,,,,,,,,,,,,,,194]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,99],b:[]},{n:[111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111],b:[]},{n:[114,126,,126,114,,126,114,114,126,,126,114,,126,114,114,126,,126,114,,126,114,116,128,,128,116,,114,121],b:[]},{n:[],b:[]}]},{a:[0,255,117,1,0,255,110,
0,1,0,4,6,35,0,0,0,0,0,0,2,14,1,1,39,76,5,0,0],p:[,1,1,1,1,1,1,2,,,,1,1,1,1,1,1,,,1,1,1,1,1,1],c:[{n:[147,,,,,,147,,,,147,,,,,,147,,,,,,147,,,,147,,,,147],b:[]},{n:[147],b:[]}]},{a:[0,0,140,0,0,0,140,0,0,60,4,10,68,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,1,1,2,3,2,3,4,,,,2,3,2,3,2,3,,,5,5,5,5,5,5,4],c:[{n:[,,,,147,,,,,,,,148,,,,,,,,147,,,,,,,,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,
,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,147,147,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,68]},{n:[147,,,147,,,147,,147,,,147,,147,,147,147,,,147,,,147,,147,,,147,,147,,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]}]},{a:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,0,0,136,5,1,2,8,92,21,56,148,5,85,8],p:[3,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[111],b:[]},{n:[114],b:[]},{n:[111],b:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,5,,,,,,
,,,,,,,,,,,,,,,,,,,,,,,,,56]}]},{a:[3,0,127,0,3,68,127,0,1,218,4,4,40,0,0,1,55,4,1,2,67,115,124,190,67,6,39,1],p:[,,,1,2,1,2,3,,,,1,2,1,2,1,2,,,1,4,1,4,1,4,3],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],b:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,147,147],b:[]},{n:[147],b:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,147],b:[]}]},{a:[0,91,128,0,0,95,128,12,0,0,12,0,67,0,0,0,0,0,0,2,255,15,0,32,83,3,134,4],p:[,,,1,2,3,2,1,2,,,1,2,3,2,1,2,,,,,4,5,4,5],c:[{n:[159,,147,,154,,147,,157,
,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],b:[5,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,157,,162,,126],b:[]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],b:[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[159,,162,,164,,,,159,,162,164,,,162,,159,,162,,164,,,,159,,162,164,,,162],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[157,,162,,164,,,,157,,162,164,,,162,,157,,162,,164,
,,,157,,162,164,,,162],b:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]}]},{a:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,3,179,5,1,3,37,135,63,67,150,3,157,6],p:[,,,,,,,,,1,2,3,,1,2,1,2,3,,4,5,,,,,3],c:[{n:[123,,,,,,,,,,,,,,,,130],b:[11,24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,92,67]},{n:[133,,,,,,,,,,,,,,,138,126,,,,,,,,,,,,125],b:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,11,,,,95,,,,,,,,,,,,,,,,,,,,,,,,,,,,29]},{n:[123],b:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,52,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},
{n:[123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,116],b:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,95]},{n:[133,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,126,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,118],b:[]}]},{a:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,16,83,5,53,1],p:[,,,,,,,1,,,,,,,,,,1,,,,,,,,1],c:[{n:[147],b:[]}]}],D:5513,C:32,H:26,L:8};d=a;e=a.H;q=0;g=a.D*a.C*(e+1)*2;f=new Int32Array(g)};this.I=function(){var p,J,B,n,y,u=new Int32Array(g),m=d.M[q],z=d.D,Y=d.C,la=0,Z=0,F;var G=
!1;var aa=[];for(J=0;J<=e;++J){var U=m.p[J];for(B=0;B<Y;++B){if(y=U?m.c[U-1].b[B]:0)m.a[y-1]=m.c[U-1].b[B+Y]||0,16>y&&(aa=[]);var Xa=c[m.a[15]],Ya=m.a[16]/512,Za=Math.pow(2,m.a[17]-9)/z,$a=m.a[18],Ca=m.a[19],ab=135.82764118168*m.a[20]/44100,bb=1-m.a[21]/255,ma=1E-5*m.a[22],cb=m.a[23]/32,db=m.a[24]/512,eb=6.283184*Math.pow(2,m.a[25]-9)/z,Da=m.a[26]/255,na=m.a[27]*z&-2;y=(J*Y+B)*z;for(n=0;4>n;++n)if(p=U?m.c[U-1].n[B+n*Y]:0){if(!aa[p]){var h=aa;var K=p;var Ea=F=void 0,ba,H,r=m,Fa=p,fb=c[r.a[0]],gb=r.a[1],
hb=r.a[3],ib=c[r.a[4]],jb=r.a[5],kb=r.a[8],Ga=r.a[9],R=r.a[10]*r.a[10]*4,ca=r.a[11]*r.a[11]*4,oa=r.a[12]*r.a[12]*4,lb=1/oa,V=r.a[13],mb=z*Math.pow(2,2-r.a[14]),Ha=new Int32Array(R+ca+oa),Ia=0,Ja=0;for(ba=H=0;H<R+ca+oa;H++,ba++){0<=ba&&(V=V>>8|(V&255)<<4,ba-=mb,Ea=.003959503758*Math.pow(2,(Fa+(V&15)+r.a[2]-128-128)/12),F=.003959503758*Math.pow(2,(Fa+(V&15)+r.a[6]-128-128)/12)*(1+8E-4*r.a[7]));var L=1;H<R?L=H/R:H>=R+ca&&(L-=(H-R-ca)*lb);var W=Ea;hb&&(W*=L*L);Ia+=W;var pa=fb(Ia)*gb;W=F;kb&&(W*=L*L);
Ja+=W;pa+=ib(Ja)*jb;Ga&&(pa+=(2*Math.random()-1)*Ga);Ha[H]=80*pa*L|0}h[K]=Ha}K=aa[p];p=0;for(h=2*y;p<K.length;p++,h+=2)u[h]+=K[p]}for(p=0;p<z;p++)n=2*(y+p),(h=u[n])||G?(G=ab,$a&&(G*=Xa(Za*n)*Ya+.5),G=1.5*Math.sin(G),la+=G*Z,h=bb*(h-Z)-la,Z+=G*h,h=3==Ca?Z:1==Ca?h:la,ma&&(h*=ma,h=1>h?-1<h?a(.25*h):-1:1,h/=ma),h*=cb,G=1E-5<h*h,K=Math.sin(eb*n)*db+.5,F=h*(1-K),h*=K):F=0,n>=na&&(F+=u[n-na+1]*Da,h+=u[n-na]*Da),u[n]=F|0,u[n+1]=h|0,f[n]+=F|0,f[n+1]+=h|0}}q++;return q/d.L};this.G=function(){var a=44+2*g-8,
c=a-36,d=new Uint8Array(44+2*g);d.set([82,73,70,70,a&255,a>>8&255,a>>16&255,a>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,c&255,c>>8&255,c>>16&255,c>>24&255]);a=0;for(c=44;a<g;++a){var e=f[a];e=-32767>e?-32767:32767<e?32767:e;d[c++]=e&255;d[c++]=e>>8&255}return d};this.getData=function(a,c){for(var d=2*Math.floor(44100*a),p=Array(c),e=0;e<2*c;e+=1){var g=d+e;p[e]=0<a&&g<f.length?f[g]/32768:0}return p}};da.J();var ea=setInterval(function(){if(1<=da.I()){clearInterval(ea);var a=da.G();a=URL.createObjectURL(new Blob([a],{type:"audio/wav"}));a=new Audio(a);a.addEventListener("ended",function(){this.currentTime=0;this.play()},!1);a.play()}},1);var fa=document;var ha=console.log.bind(console),b=Math.random,k=2*Math.PI;function ia(a,c){return function(){a();c()}}function ja(a,c,d){var e=0;d.forEach(function(d){d.i.f==c&&(e+=k/a)});if(!(e>=k))return e}function l(a,c,d){return"hsl("+(0>a?360*b():a)+","+(0>c?100*b():c)+"%,"+(0>d?100*b():d)+"%)"};var A=function(){var a={x:0,y:0,s:0,u:0,click:!1,l:!1,release:!1,A:!1,o:!1,update:function(){a.click=!1;a.release=!1;a.o=!1;a.A=!1}};window.addEventListener("mousemove",function(c){var d=t.getBoundingClientRect();a.x=c.clientX-d.left;a.y=c.clientY-d.top;a.s=(a.x+v-t.width/2)/w;a.u=(a.y+x-t.height/2)/w;a.B&&(a.l=!0)},!1);window.addEventListener("mousedown",function(){a.click=!0;a.B=!0},!1);window.addEventListener("mouseup",function(){a.B=!1;a.l||(a.release=!0);a.l=!1},!1);window.addEventListener("mousewheel",
function(c){a.A=0<c.deltaY;a.o=0>c.deltaY},!1);return a}();var ka=[];var qa="",t=fa.getElementById("c"),C=t.getContext("2d"),v=0,x=0,ra=0,sa=0,ta=0,ua=0,va=0,wa=0,w=1,xa=1,D=2;function ya(){if(A.o||A.A){var a=xa+(A.o?.1:-.1);xa=2<a?2:.1>a?.1:a}D=Math.min(1+(w-.1),2);A.click&&!za.display&&(Aa=!0,ta=v,ua=x,va=A.x,wa=A.y);A.l&&Aa?(ra=ta+(va-A.x),sa=ua+(wa-A.y)):A.release&&(Aa=!1);a=w;w+=(xa-w)/5;a=w-a;.001<Math.abs(a)&&(v+=A.s*a,x+=A.u*a,ra=v,sa=x);v+=(ra-v)/5;x+=(sa-x)/5}function Ba(){C.setTransform(1,0,0,1,0,0)}
function Ka(){C.setTransform(w,0,0,w,-v+t.width/2,-x+t.height/2)}var Aa;La();window.addEventListener("resize",La,!1);function La(){t.width=window.innerWidth;t.height=window.innerHeight;C.clearRect(0,0,t.width,t.height)}
function Ma(a,c,d,e,q,g,f,p,J,B,n,y,u,m,z){void 0===p&&(p=1);void 0===y&&(y=0);void 0===u&&(u=k);void 0===m&&(m=0);void 0===z&&(z=!1);void 0===n&&(n=0);a.beginPath();a.globalAlpha=p;a[c+"Style"]=f;a.lineWidth=J/w;a.shadowColor=B;a.shadowBlur=n;a.ellipse(d,e,q,q*(g?1/D:1),m,y,u,z);a[c]()}
function Na(a,c,d){if(!a.cache){var e=fa.createElement("CANVAS");e.width=256;e.height=256;a.cache=e;e=a.cache.getContext("2d");var q=a.m?"#ffffff":a.color,g=a.m?50:10;a.m&&(e.filter="blur(4px)");Ma(e,"fill",128,128,a.size,!1,q,1,0,a.color,g);if(a.i)for(g=q=a.size,e.beginPath(),e.arc(128,128,a.size,0,2*Math.PI,!1),e.clip();q--;)Ma(e,"fill",128-g/2+(a.size-g)/2,128,2*g--,!1,"#000000",.05,0,"#000000",10,-k/4,k/4);e.filter="none"}e=Oa[0];e=Math.atan2((a.y-e.y)*D,a.x-e.x);C.globalAlpha=1;C.shadowBlur=
0;void 0===c&&(c=a.x);void 0===d&&(d=a.y);C.translate(c,d);C.rotate(e);a.m&&(c=1+.03*b(),C.scale(c,c));C.drawImage(a.cache,-128,-128);Ka()};var Pa=fa.createElement("CANVAS");Pa.width=512;Pa.height=512;var E=Pa.getContext("2d");E.shadowBlur=1;E.globalAlpha=.5;for(var Qa=300;Qa--;){var Ra=512*Math.random(),Sa=512*Math.random(),Ta=l(-1,100,90);E.fillStyle=Ta;E.shadowColor=Ta;E.beginPath();E.arc(Ra,Sa,.5,0,2*Math.PI);E.fill()}var Ua=C.createPattern(Pa,"repeat");
function Va(){var a=performance.now()/2E3;C.rect(0,0,t.width,t.height);C.fillStyle=Ua;C.save();C.translate(t.width/2,t.height/2);C.scale(.5,.5);C.translate(-v/25+a/2,-x/25);C.save();C.rotate(a/200);C.fill();C.restore();C.scale(2,2);C.translate(-v/25+a,-x/25);C.rotate(a/200);C.fill();C.restore()};var Oa=[],I=[],Wa=[];
function M(a,c,d,e,q,g){void 0===g&&(g=0);var f={name:"Some Shithole Planet",type:"orbital",x:0,y:0};f.color=a;f.size=c;f.m=!1;d&&(f.i={f:d,j:e,speed:q,angle:g});f.update=function(){var a=A.s-f.x,c=A.u-f.y;Math.sqrt(a*a+c*c)<f.size+5&&(qa=f.name,A.release&&za.show(f));f.i&&(a=f.i,a.angle+=a.speed,f.x=a.j*Math.cos(a.angle)+a.f.x,f.y=a.j/D*Math.sin(a.angle)+a.f.y)};f.g=function(){var a=f.i;a&&(C.setLineDash([5,5]),Ma(C,"stroke",a.f.x,a.f.y,a.j,!0,f.color,.3,1),C.setLineDash([]));(a=f.i)&&Ma(C,"stroke",
a.f.x,a.f.y,a.j,!0,f.color,.3,3,f.color,5,a.angle-a.speed*a.j,a.angle,0,0>a.speed);Na(f,f.x,f.y)};Oa.push(f);return f}function N(a,c,d,e,q,g){void 0===g&&(g=0);a=M(a,c,d,e+c/2,q,g);a.name=a.type="planet";a.update=ia(a.update,function(){});return a}function nb(a){void 0!==ja(ob,a,I)&&(a=M(l(212,100,97),2,a,3*a.size,-.005),a.name=a.type="mining",a.update=ia(a.update,function(){O.w+=O.K}))}var ob=4;
function P(a){var c=ja(pb,a,I);if(void 0!==c){var d=M(l(160,100,50),2,a,5*a.size,.01,c);d.name=d.type="satellite";d.index=I.length;I.push(d);d.g=ia(d.g,function(){for(var a=d.index;a<I.length;a++){var c=I[a],g;if(g=c!=d){g=c.x-d.x;var f=(c.y-d.y)*D;g=Math.sqrt(g*g+f*f)<=O.F}g&&(g=d,C.setLineDash([1,1]),C.beginPath(),C.globalAlpha=.2/w,C.moveTo(g.x,g.y),f=75*(D-1),C.bezierCurveTo(g.x,g.y-f,c.x,c.y-f,c.x,c.y),C.lineWidth=1/w*2,C.strokeStyle="#00FF00",C.stroke(),C.globalAlpha=1,C.setLineDash([]))}})}}
var pb=3;function qb(a){var c=ja(rb,a,Wa);void 0!==c&&(a=M(l(33,100,50),2,a,7*a.size,.005,c),a.name=a.type="defense",a.index=Wa.length,Wa.push(a),a.g=ia(a.g,function(){}))}var rb=2;var za=function(){var a={};ka.push(a);a.display=!1;a.v=300;a.h=400;a.target=null;a.show=function(c){A.l||za.display||"planet"!=c.type||(a.display=!0,a.target=c)};a.update=function(){if(a.display){var c=A.x-t.width/2,d=A.y-t.height/2;A.click&&(c>-a.v/2&&c<a.v/2&&d>-a.h/2&&d<a.h/2?ha("logged menu"):(a.target=null,a.display=!1))}};a.g=function(){a.display&&(C.fillStyle="#141e28",C.fillRect(-a.v/2,-a.h/2,a.v,a.h),C.fillStyle="#ffffff",C.textAlign="center",C.font="24px monospace",C.fillText((O.f===a.target?
"Base":"")+" "+a.target.name,0,-a.h/2+20),Na(a.target,0,-a.h/2+100+a.target.size/2))};return a}(),O=null;window.addEventListener("contextmenu",function(a){a.preventDefault()},!1);var sb=l(60,100,50),Q=M(sb,50,null,null,null);Q.name=Q.type="sun";Q.m=!0;var S=N(l(180,39,62),10,Q,500,.003,b()*k),T={};T.f=S;T.K=.01;T.N=300;T.O=0;T.P=0;T.F=1E3;T.w=0;O=T;N(l(-1,60,70),5,S,100,-.002,b()*k);var X=N(l(-1,60,70),20,Q,1123,.0015,b()*k);N(l(-1,60,70),5,X,8*X.size,.01,b()*k);N(l(-1,60,70),10,X,9*X.size,.005);
N(l(-1,60,70),30,Q,2532,-.001,b()*k);nb(S);nb(X);P(S);P(Q);P(Q);P(Q);P(X);P(X);P(X);qb(S);qb(S);qb(S);qb(X);var tb=performance.now(),ub=1E3/60,vb=0,wb=0,xb=[];(function yb(a){requestAnimationFrame(yb);var d=tb+ub;xb.push(1/((a-vb)/1E3));vb=a;if(60<xb.length){var e=0,q=1E3,g=0;xb.shift();xb.forEach(function(a){e+=a;q=Math.min(q,a);g=Math.max(g,a)});wb=Math.floor(e/60)+", "+~~q+" - "+~~g}a>d&&(zb(Math.min(Math.floor((a-tb)/ub),60)),tb=a);Ab()})(tb);
function zb(a){qa="";ya();ka.forEach(function(a){a.update()});Oa.forEach(function(a){a.update()});A.update();--a&&zb(a)}
function Ab(){Ba();C.clearRect(0,0,t.width,t.height);C.save();C.beginPath();var a=t.width/2-v,c=t.height/2-x;a=C.createRadialGradient(a,c,0,a,c,4E3);a.addColorStop(0,"#141e28");a.addColorStop(1,"#000000");C.fillStyle=a;C.rect(0,0,t.width,t.height);C.fill();C.restore();Ba();Va();Ka();Oa.forEach(function(a){a.g()});C.setTransform(1,0,0,1,t.width/2,t.height/2);ka.forEach(function(a){a.g()});Ba();C.font="14px monospace";C.textBaseline="top";C.textAlign="left";C.fillStyle="#ffffff";C.fillText("#js13k tower defense prototype",
20,20);C.fillText("https://github.com/scorp200/td13k",20,40);C.fillText("framerate: "+wb,20,60);C.fillText("mouse (gui): "+A.x+", "+A.y,20,80);C.fillText("mouse (view): "+A.s+", "+A.u,20,100);C.fillText("planet name: "+qa,20,120);C.fillText("view x: "+v,20,160);C.fillText("view y: "+x,20,180);C.fillText("view zoom: "+w,20,200);C.fillText("view tilt: "+D,20,220);C.fillText("minerals: "+Math.floor(100*O.w)/100,20,260)};
