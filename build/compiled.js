var b=document;function h(a,c){return function(){a();c()}}function l(a,c,d){var g=0;d.forEach(function(d){d.f.a==c&&(g+=m/a)});if(!(g>=m))return g}var n=[],p="",q=b.addEventListener.bind(b),r=b.getElementById("c"),t=r.getContext("2d");function u(){t.setTransform(1,0,0,1,r.width/2,r.height/2)}v();q("resize",v);function v(){r.width=window.innerWidth;r.height=window.innerHeight;t.clearRect(0,0,r.width,r.height)}
function w(a,c,d,g,k,e,f,I,da,ea,J,K,L,M,N){void 0===I&&(I=1);void 0===K&&(K=0);void 0===L&&(L=m);void 0===M&&(M=0);void 0===N&&(N=!1);void 0===J&&(J=0);a.beginPath();a.globalAlpha=I;a[c+"Style"]=f;a.lineWidth=da;a.shadowColor=ea;a.shadowBlur=J;a.ellipse(d,g,k,k*(e?.5:1),M,K,L,N);a[c]()}
function x(a,c,d){if(!a.cache){var g=document.createElement("CANVAS");g.width=256;g.height=256;a.cache=g;g=a.cache.getContext("2d");var k=a.h?"#ffffff":a.color,e=a.h?50:a.size;a.h&&(g.filter="blur(4px)");w(g,"fill",128,128,a.size,!1,k,1,0,a.color,e);if(a.f)for(e=k=a.size;k--;)w(g,"fill",128-e/2+(a.size-e)/2,128,2*e--,!1,"#000000",.05,0,"#000000",10,-m/4,m/4);g.filter="none"}g=y[0];g=Math.atan2(2*(a.y-g.y),a.x-g.x);t.globalAlpha=1;t.shadowBlur=0;void 0===c&&(c=a.x);void 0===d&&(d=a.y);t.translate(c,
d);t.rotate(g);a.h&&(c=1+.03*aa(),t.scale(c,c));t.drawImage(a.cache,-128,-128);u()}var z=b.createElement("CANVAS");z.width=512;z.height=512;var A=z.getContext("2d");A.shadowBlur=1;A.globalAlpha=.5;for(var B="55 66 77 88 AA BB CC DD EE FF".split(" "),ba=300;ba--;){var ca=512*Math.random(),fa=512*Math.random(),C="#"+B[Math.floor(11*Math.random())]+B[Math.floor(11*Math.random())]+B[Math.floor(11*Math.random())];A.fillStyle=C;A.shadowColor=C;A.beginPath();A.arc(ca,fa,.5,0,2*Math.PI);A.fill()}
var D=0,ha=t.createPattern(z,"repeat"),y=[],E=[],F=[];
function G(a,c,d,g,k,e){e=void 0===e?0:e;void 0===e&&(e=0);var f={name:"Some Shithole Planet",x:0,y:0};f.color=a;f.size=c;f.h=!1;d&&(f.f={a:d,g:g,speed:k,angle:e});f.update=function(){var a=H.x-r.width/2-f.x,c=H.y-r.height/2-f.y;Math.sqrt(a*a+c*c)<f.size+5&&(p=f.name,H.click&&!O.display&&(H.click=!1,P("clicked "+f.name),O.show(f)));f.f&&(a=f.f,a.angle+=a.speed,f.x=a.g*Math.cos(a.angle)+a.a.x,f.y=.5*a.g*Math.sin(a.angle)+a.a.y)};f.b=function(){var a=f.f;a&&(t.setLineDash([5,5]),w(t,"stroke",a.a.x,
a.a.y,a.g,!0,f.color,.3,1),t.setLineDash([]));(a=f.f)&&w(t,"stroke",a.a.x,a.a.y,a.g,!0,f.color,.3,3,f.color,5,a.angle-a.speed*a.g,a.angle,0,0>a.speed);x(f,f.x,f.y)};y.push(f);return f}function Q(a,c,d,g,k){a=G(a,c,d,g,k,0);a.name="planet";a.update=h(a.update,function(){});return a}
function R(a){var c=l(3,a,E);if(void 0!==c){var d=G("#00ffab",2,a,3*a.size,.01,c);d.name="satellite";d.index=E.length;E.push(d);d.b=h(d.b,function(){for(var a=d.index;a<E.length;a++){var c=E[a],e;if(e=c!=d){e=c.x-d.x;var f=c.y-d.y;e=300>=Math.sqrt(e*e+f*f)}e&&(e=d,t.setLineDash([1,1]),t.beginPath(),t.globalAlpha=.2,t.moveTo(e.x,e.y),t.bezierCurveTo(e.x,e.y-50,c.x,c.y-50,c.x,c.y),t.lineWidth=1,t.strokeStyle=e.color,t.stroke(),t.globalAlpha=1,t.setLineDash([]))}})}}
function S(){var a=T,c=l(2,a,F);void 0!==c&&(a=G("#ff8d00",2,a,4*a.size,.005,c),a.name="defense",a.index=F.length,F.push(a),a.b=h(a.b,function(){}))}
var P=console.log.bind(console),aa=Math.random,m=2*Math.PI,U=0,O=function(){var a={};n.push(a);a.display=!1;a.i=300;a.c=600;a.target=null;a.show=function(c){P("test",c.name);a.display=!0;a.target=c};a.update=function(){var c=H.x-r.width/2,d=H.y-r.height/2;c>-a.i/2&&c<a.i/2&&d>-a.c/2&&d<a.c/2?H.click&&P("DON'T LEAVE BLOCKS BLANK!"):H.click&&(a.target=null,a.display=!1)};a.b=function(){a.display&&(t.fillStyle="#141e28",t.fillRect(-a.i/2,-a.c/2,a.i,a.c),t.fillStyle="#ffffff",t.textAlign="center",t.font=
"24px monospace",t.fillText(a.target.name,0,.45*-a.c),x(a.target,0,.3*-a.c))};return a}();q("contextmenu",function(a){a.preventDefault()});var V=G("#ffe200",38,null,null,null);V.name="sun";V.h=!0;var T=Q("#77c3c3",10,V,200,.005);Q("#666666",5,T,50,-.01);var W=Q("#f64749",20,V,500,.0025);Q("#ff0055",5,W,80,.05);var ia=Q("#77ff55",10,W,150,.005);Q("#666666",5,ia,50,-.01);(function(a){if(void 0!==l(4,a,E))return a=G("#f0f7ff",2,a,2*a.size,-.005),a.update=h(a.update,function(){U+=.01}),a})(T);R(T);R(V);
R(V);R(V);R(W);R(W);R(W);S();S();S();var H=function(){var a={x:0,y:0,click:!1};q("mousemove",function(c){var d=r.getBoundingClientRect();a.x=c.clientX-d.left;a.y=c.clientY-d.top});q("mousedown",function(c){a.click=!0;c.preventDefault()});return a}(),X=performance.now(),Y=1E3/60,ja=0,ka=0,Z=[];
(function la(a){requestAnimationFrame(la);var d=X+Y;Z.push(1/((a-ja)/1E3));ja=a;if(60<Z.length){var g=0,k=1E3,e=0;Z.shift();Z.forEach(function(a){g+=a;k=Math.min(k,a);e=Math.max(e,a)});ka=Math.floor(g/60)+", "+~~k+" - "+~~e}a>d&&(ma(Math.min(Math.floor((a-X)/Y),60)),X=a);na()})(X);function ma(a){p="";y.forEach(function(a){a.update()});n.forEach(function(a){a.update()});H.click=!1;--a&&ma(a)}
function na(){t.setTransform(1,0,0,1,0,0);t.clearRect(0,0,r.width,r.height);D+=.1;t.rect(0,0,r.width,r.height);t.fillStyle=ha;t.save();t.scale(.5,.5);t.translate(D/2,0);t.fill();t.translate(D,0);t.scale(2,2);t.fill();t.restore();u();y.forEach(function(a){a.b()});n.forEach(function(a){a.b()});t.setTransform(1,0,0,1,0,0);t.font="14px monospace";t.textBaseline="top";t.textAlign="left";t.fillStyle="#ffffff";t.fillText("#js13k tower defense prototype",20,20);t.fillText("https://github.com/scorp200/td13k",
20,40);t.fillText("framerate: "+ka,20,60);t.fillText("mouse (gui): "+H.x+", "+H.y,20,80);t.fillText("mouse (view): "+(H.x-r.width/2)+", "+(H.y-r.height/2),20,100);t.fillText("planet name: "+p,20,120);t.fillText("Minerals: "+Math.floor(100*U)/100,20,140)};
