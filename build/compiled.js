var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a){if(a){for(var b=ba,d=["Array","prototype","fill"],e=0;e<d.length-1;e++){var k=d[e];k in b||(b[k]={});b=b[k]}d=d[d.length-1];e=b[d];a=a(e);a!=e&&null!=a&&aa(b,d,{configurable:!0,writable:!0,value:a})}}
ca(function(a){return a?a:function(a,d,e){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==e||e>b)e=b;e=Number(e);0>e&&(e=Math.max(0,b+e));for(d=Number(d||0);d<e;d++)this[d]=a;return this}});var c=document;function h(a,b){return function(){a();b()}}function l(a,b,d){var e=0;d.forEach(function(d){d.f.a==b&&(e+=m/a)});if(!(e>=m))return e};var n=[];var p="",q=c.addEventListener,r=c.getElementById("c"),t=r.getContext("2d");function u(){t.setTransform(1,0,0,1,r.width/2,r.height/2)}v();q("resize",v);function v(){r.width=window.innerWidth;r.height=window.innerHeight;t.clearRect(0,0,r.width,r.height)}
function w(a,b,d,e,k,g,f,H,ha,ia,I,J,K,L,M){void 0===H&&(H=1);void 0===J&&(J=0);void 0===K&&(K=m);void 0===L&&(L=0);void 0===M&&(M=!1);void 0===I&&(I=0);a.beginPath();a.globalAlpha=H;a[b+"Style"]=f;a.lineWidth=ha;a.shadowColor=ia;a.shadowBlur=I;a.ellipse(d,e,k,k*(g?.5:1),L,J,K,M);a[b]()}
function x(a,b,d){if(!a.cache){var e=document.createElement("CANVAS");e.width=256;e.height=256;a.cache=e;e=a.cache.getContext("2d");var k=a.h?"#ffffff":a.color,g=a.h?50:a.size;a.h&&(e.filter="blur(4px)");w(e,"fill",128,128,a.size,!1,k,1,0,a.color,g);if(a.f)for(g=k=a.size;k--;)w(e,"fill",128-g/2+(a.size-g)/2,128,2*g--,!1,"#000000",.05,0,"#000000",10,-m/4,m/4);e.filter="none"}e=y[0];e=Math.atan2(2*(a.y-e.y),a.x-e.x);t.globalAlpha=1;t.shadowBlur=0;void 0===b&&(b=a.x);void 0===d&&(d=a.y);t.translate(b,
d);t.rotate(e);a.h&&(b=1+.03*da(),t.scale(b,b));t.drawImage(a.cache,-128,-128);u()};var z=c.createElement("CANVAS");z.width=512;z.height=512;var A=z.getContext("2d");A.shadowBlur=1;A.globalAlpha=.5;for(var B="55 66 77 88 AA BB CC DD EE FF".split(" "),ea=300;ea--;){var fa=512*Math.random(),ja=512*Math.random(),C="#"+B[Math.floor(11*Math.random())]+B[Math.floor(11*Math.random())]+B[Math.floor(11*Math.random())];A.fillStyle=C;A.shadowColor=C;A.beginPath();A.arc(fa,ja,.5,0,2*Math.PI);A.fill()}var D=0,ka=t.createPattern(z,"repeat");var y=[],E=[],F=[];
function G(a,b,d,e,k,g){g=void 0===g?0:g;void 0===g&&(g=0);var f={name:"Some Shithole Planet",x:0,y:0};f.color=a;f.size=b;f.h=!1;d&&(f.f={a:d,g:e,speed:k,angle:g});f.update=function(){var a=N.x-r.width/2-f.x,b=N.y-r.height/2-f.y;Math.sqrt(a*a+b*b)<f.size+5&&(p=f.name,N.click&&!O.display&&(N.click=!1,P("clicked "+f.name),O.show(f)));f.f&&(a=f.f,a.angle+=a.speed,f.x=a.g*Math.cos(a.angle)+a.a.x,f.y=.5*a.g*Math.sin(a.angle)+a.a.y)};f.b=function(){var a=f.f;a&&(t.setLineDash([5,5]),w(t,"stroke",a.a.x,
a.a.y,a.g,!0,f.color,.3,1),t.setLineDash([]));(a=f.f)&&w(t,"stroke",a.a.x,a.a.y,a.g,!0,f.color,.3,3,f.color,5,a.angle-a.speed*a.g,a.angle,0,0>a.speed);x(f)};y.push(f);return f}function Q(a,b,d,e,k){a=G(a,b,d,e,k,0);a.name="planet";a.update=h(a.update,function(){});return a}
function R(a){var b=l(3,a,E);if(void 0!==b){var d=G("#00ffab",2,a,3*a.size,.01,b);d.name="satellite";d.index=E.length;E.push(d);d.b=h(d.b,function(){for(var a=d.index;a<E.length;a++){var b=E[a];if(b!=d&&300>=Math.sqrt(Math.pow(b.x-d.x,2)+Math.pow(b.y-d.y,2))){var g=d;t.setLineDash([1,1]);t.beginPath();t.globalAlpha=.2;t.moveTo(g.x,g.y);t.bezierCurveTo(g.x,g.y-50,b.x,b.y-50,b.x,b.y);t.lineWidth=1;t.strokeStyle=g.color;t.stroke();t.globalAlpha=1;t.setLineDash([])}}})}}
function S(){var a=T,b=l(2,a,F);void 0!==b&&(a=G("#ff8d00",2,a,4*a.size,.005,b),a.name="defense",a.index=F.length,F.push(a),a.b=h(a.b,function(){}))};var P=console.log,da=Math.random,m=2*Math.PI,U=0,O=new function(){var a=this;n.push(a);a.display=!1;a.i=300;a.c=600;a.target=null;a.show=function(b){P("test",b.name);a.display=!0;a.target=b};a.update=function(){var b=N.x-r.width/2,d=N.y-r.height/2;b>-a.i/2&&b<a.i/2&&d>-a.c/2&&d<a.c/2||!N.click||(a.target=null,a.display=!1)};a.b=function(){a.display&&(t.fillStyle="#141e28",t.fillRect(-a.i/2,-a.c/2,a.i,a.c),t.fillStyle="#ffffff",t.textAlign="center",t.font="24px monospace",t.fillText(a.target.name,
0,.45*-a.c),x(a.target,0,.3*-a.c))}};q("contextmenu",function(a){a.preventDefault()});var V=G("#ffe200",38,null,null,null);V.name="sun";V.h=!0;var T=Q("#77c3c3",10,V,200,.005);Q("#666666",5,T,50,-.01);var W=Q("#f64749",20,V,500,.0025);Q("#ff0055",5,W,80,.05);var la=Q("#77ff55",10,W,150,.005);Q("#666666",5,la,50,-.01);(function(a){if(void 0!==l(4,a,E))return a=G("#f0f7ff",2,a,2*a.size,-.005),a.update=h(a.update,function(){U+=.01}),a})(T);R(T);R(V);R(V);R(V);R(W);R(W);R(W);S();S();S();
var N=function(){var a={x:0,y:0,click:!1};q("mousemove",function(b){var d=r.getBoundingClientRect();a.x=b.clientX-d.left;a.y=b.clientY-d.top});q("mousedown",function(b){a.click=!0;b.preventDefault()});return a}(),X=performance.now(),Y=1E3/60,ma=0,na=0,Z=[];
(function oa(a){requestAnimationFrame(oa);var d=X+Y,e=0;Z.push(1/((a-ma)/1E3));ma=a;if(60<Z.length){var k=0,g=1E3,f=0;Z.shift();Z.forEach(function(a){k+=a;g=Math.min(g,a);f=Math.max(f,a)});na=Math.floor(k/60)+", "+~~g+" - "+~~f}a>d&&(e=Math.floor((a-X)/Y),pa(Math.min(e,60)),X=a);qa()})();function pa(a){p="";y.forEach(function(a){a.update()});n.forEach(function(a){a.update()});N.click=!1;--a&&pa(a)}
function qa(){t.setTransform(1,0,0,1,0,0);t.clearRect(0,0,r.width,r.height);D+=.1;t.rect(0,0,r.width,r.height);t.fillStyle=ka;t.save();t.scale(.5,.5);t.translate(D/2,0);t.fill();t.translate(D,0);t.scale(2,2);t.fill();t.restore();u();y.forEach(function(a){a.b()});n.forEach(function(a){a.b()});t.setTransform(1,0,0,1,0,0);t.font="14px monospace";t.textBaseline="top";t.textAlign="left";t.fillStyle="#ffffff";t.fillText("#js13k tower defense prototype",20,20);t.fillText("https://github.com/scorp200/td13k",
20,40);t.fillText("framerate: "+na,20,60);t.fillText("mouse (gui): "+N.x+", "+N.y,20,80);t.fillText("mouse (view): "+(N.x-r.width/2)+", "+(N.y-r.height/2),20,100);t.fillText("planet name: "+p,20,120);t.fillText("Minerals: "+Math.floor(100*U)/100,20,140)};
