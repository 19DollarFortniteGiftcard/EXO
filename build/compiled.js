var c=document;var da=console.log.bind(console),h=Math.random,k=Math.round,m=2*Math.PI;function n(a,b){return function(){a();b()}}function p(a,b,d){var e=0;d.forEach(function(d){d.f.b==b&&(e+=m/a)});if(!(e>=m))return e}function q(a){a.a=void 0===a.a?360*h():a.a;a.l=void 0===a.l?100*h():a.l;a.j=void 0===a.j?100*h():a.j;return r(k(a.a),k(a.l),k(a.j))+""}function r(a,b,d){return"hsl("+a+","+b+"%, "+d+"%)"};var x=function(){var a={x:0,y:0,v:0,w:0,click:!1,h:!1,release:!1,u:!1,s:!1,update:function(){a.click=!1;a.release=!1;a.s=!1;a.u=!1}};window.addEventListener("mousemove",function(b){var d=t.getBoundingClientRect();a.x=b.clientX-d.left;a.y=b.clientY-d.top;a.v=(a.x+u-t.width/2)/v;a.w=(a.y+w-t.height/2)/v;a.A&&(a.h=!0)},!1);window.addEventListener("mousedown",function(){a.click=!0;a.A=!0},!1);window.addEventListener("mouseup",function(){a.A=!1;a.h||(a.release=!0);a.h=!1},!1);window.addEventListener("mousewheel",
function(b){a.u=0<b.deltaY;a.s=0>b.deltaY},!1);return a}();var y=[];var z="",ea=c.addEventListener.bind(c),t=c.getElementById("c"),A=t.getContext("2d"),u=0,w=0,fa=0,ha=0,ia=0,ja=0,v=1;function B(){A.setTransform(1,0,0,1,0,0)}function ka(){A.setTransform(v,0,0,v,-u+t.width/2,-w+t.height/2)}var C;la();window.addEventListener("resize",la,!1);function la(){t.width=window.innerWidth;t.height=window.innerHeight;A.clearRect(0,0,t.width,t.height)}
function D(a,b,d,e,l,f,g,U,va,wa,V,W,X,Y,Z){void 0===U&&(U=1);void 0===W&&(W=0);void 0===X&&(X=m);void 0===Y&&(Y=0);void 0===Z&&(Z=!1);void 0===V&&(V=0);a.beginPath();a.globalAlpha=U;a[b+"Style"]=g;a.lineWidth=va;a.shadowColor=wa;a.shadowBlur=V;a.ellipse(d,e,l,l*(f?.5:1),Y,W,X,Z);a[b]()}
function ma(a,b,d){if(!a.cache){var e=c.createElement("CANVAS");e.width=256;e.height=256;a.cache=e;e=a.cache.getContext("2d");var l=a.i?"#ffffff":a.color,f=a.i?50:10;a.i&&(e.filter="blur(4px)");D(e,"fill",128,128,a.size,!1,l,1,0,a.color,f);if(a.f)for(f=l=a.size,e.beginPath(),e.arc(128,128,a.size,0,2*Math.PI,!1),e.clip();l--;)D(e,"fill",128-f/2+(a.size-f)/2,128,2*f--,!1,"#000000",.05,0,"#000000",10,-m/4,m/4);e.filter="none"}e=E[0];e=Math.atan2(2*(a.y-e.y),a.x-e.x);A.globalAlpha=1;A.shadowBlur=0;void 0===
b&&(b=a.x);void 0===d&&(d=a.y);A.translate(b,d);A.rotate(e);a.i&&(b=1+.03*h(),A.scale(b,b));A.drawImage(a.cache,-128,-128);ka()};var F=c.createElement("CANVAS");F.width=512;F.height=512;var G=F.getContext("2d");G.shadowBlur=1;G.globalAlpha=.5;for(var na=300;na--;){var oa=512*Math.random(),pa=512*Math.random(),qa=q({l:100,j:97});G.fillStyle=qa;G.shadowColor=qa;G.beginPath();G.arc(oa,pa,.5,0,2*Math.PI);G.fill()}var ra=A.createPattern(F,"repeat");
function sa(){var a=performance.now()/2E3;A.rect(0,0,t.width,t.height);A.fillStyle=ra;A.save();A.translate(t.width/2,t.height/2);A.scale(.5,.5);A.translate(-u/25+a/2,-w/25);A.save();A.rotate(a/200);A.fill();A.restore();A.scale(2,2);A.translate(-u/25+a,-w/25);A.rotate(a/200);A.fill();A.restore()};var E=[],H=[],ta=[];
function I(a,b,d,e,l,f){f=void 0===f?0:f;void 0===f&&(f=0);var g={name:"Some Shithole Planet",type:"orbital",x:0,y:0};g.color=a;da(a);g.size=b;g.i=!1;d&&(g.f={b:d,g:e,speed:l,angle:f});g.update=function(){var a=x.v-g.x,b=x.w-g.y;Math.sqrt(a*a+b*b)<g.size+5&&(z=g.name,x.release&&ua.show(g));g.f&&(a=g.f,a.angle+=a.speed,g.x=a.g*Math.cos(a.angle)+a.b.x,g.y=.5*a.g*Math.sin(a.angle)+a.b.y)};g.c=function(){var a=g.f;a&&(A.setLineDash([5,5]),D(A,"stroke",a.b.x,a.b.y,a.g,!0,g.color,.3,1),A.setLineDash([]));
(a=g.f)&&D(A,"stroke",a.b.x,a.b.y,a.g,!0,g.color,.3,3,g.color,5,a.angle-a.speed*a.g,a.angle,0,0>a.speed);ma(g,g.x,g.y)};E.push(g);return g}function J(a,b,d,e,l,f){a=I(a,b,d,e+b/2,l,void 0===f?0:f);a.name=a.type="planet";a.update=n(a.update,function(){});return a}function xa(a){void 0!==p(ya,a,H)&&(a=I(r(212,100,97),2,a,3*a.size,-.005),a.name=a.type="mining",a.update=n(a.update,function(){K.o+=K.C}))}var ya=4;
function L(a){var b=p(za,a,H);if(void 0!==b){var d=I(r(160,100,50),2,a,5*a.size,.01,b);d.name=d.type="satellite";d.index=H.length;H.push(d);d.c=n(d.c,function(){for(var a=d.index;a<H.length;a++){var b=H[a],f;if(f=b!=d){f=b.x-d.x;var g=2*(b.y-d.y);f=Math.sqrt(f*f+g*g)<=K.B}f&&(f=d,A.setLineDash([1,1]),A.beginPath(),A.globalAlpha=.2,A.moveTo(f.x,f.y),A.bezierCurveTo(f.x,f.y-50,b.x,b.y-50,b.x,b.y),A.lineWidth=1,A.strokeStyle=f.color,A.stroke(),A.globalAlpha=1,A.setLineDash([]))}})}}var za=3;
function M(a){var b=p(Aa,a,ta);void 0!==b&&(a=I(r(33,100,50),2,a,7*a.size,.005,b),a.name=a.type="defense",a.index=ta.length,ta.push(a),a.c=n(a.c,function(){}))}var Aa=2;var ua=function(){var a={};y.push(a);a.display=!1;a.m=300;a.a=400;a.target=null;a.show=function(b){x.h||ua.display||"planet"!=b.type||(a.display=!0,a.target=b)};a.update=function(){if(a.display){var b=x.x-t.width/2,d=x.y-t.height/2;x.click&&(b>-a.m/2&&b<a.m/2&&d>-a.a/2&&d<a.a/2?da("logged menu"):(a.target=null,a.display=!1))}};a.c=function(){a.display&&(A.fillStyle="#141e28",A.fillRect(-a.m/2,-a.a/2,a.m,a.a),A.fillStyle="#ffffff",A.textAlign="center",A.font="24px monospace",A.fillText((K.b===a.target?
"Base":"")+" "+a.target.name,0,-a.a/2+20),ma(a.target,0,-a.a/2+100+a.target.size/2))};return a}(),K=null;ea("contextmenu",function(a){a.preventDefault()});var N=I(r(60,100,50),50,null,null,null);N.name=N.type="sun";N.i=!0;var O=J(r(180,39,62),10,N,500,.003,h()*m),P={};P.b=O;P.C=.01;P.D=300;P.F=0;P.G=0;P.B=1E3;P.o=0;K=P;var Q={l:39,j:62};J(q(Q),5,O,100,-.002,h()*m);var R=J(q(Q),20,N,1123,.0015,h()*m);J(q(Q),5,R,8*R.size,.01,h()*m);J(q(Q),10,R,9*R.size,.005);J(q(Q),30,N,2532,-.001,h()*m);xa(O);xa(R);
L(O);L(N);L(N);L(N);L(R);L(R);L(R);M(O);M(O);M(O);M(R);var S=performance.now(),Ba=1E3/60,Ca=0,Da=0,T=[];(function Ea(a){requestAnimationFrame(Ea);var d=S+Ba;T.push(1/((a-Ca)/1E3));Ca=a;if(60<T.length){var e=0,l=1E3,f=0;T.shift();T.forEach(function(a){e+=a;l=Math.min(l,a);f=Math.max(f,a)});Da=Math.floor(e/60)+", "+~~l+" - "+~~f}a>d&&(Fa(Math.min(Math.floor((a-S)/Ba),60)),S=a);Ga()})(S);
function Fa(a){z="";x.s&&(v=Math.min(v+.1,2));x.u&&(v=Math.max(v-.1,.1));x.click&&!ua.display&&(C=!0,fa=u,ha=w,ia=x.x,ja=x.y);x.h&&C?(u=fa+(ia-x.x),w=ha+(ja-x.y)):x.release&&(C=!1);y.forEach(function(a){a.update()});E.forEach(function(a){a.update()});x.update();--a&&Fa(a)}
function Ga(){B();A.clearRect(0,0,t.width,t.height);A.save();var a=t.width/2-u,b=t.height/2-w;a=A.createRadialGradient(a,b,0,a,b,4E3);a.addColorStop(0,"#141e28");a.addColorStop(1,"#000000");A.fillStyle=a;A.rect(0,0,t.width,t.height);A.fill();A.restore();B();sa();ka();E.forEach(function(a){a.c()});A.setTransform(1,0,0,1,t.width/2,t.height/2);y.forEach(function(a){a.c()});B();A.font="14px monospace";A.textBaseline="top";A.textAlign="left";A.fillStyle="#ffffff";A.fillText("#js13k tower defense prototype",
20,20);A.fillText("https://github.com/scorp200/td13k",20,40);A.fillText("framerate: "+Da,20,60);A.fillText("mouse (gui): "+x.x+", "+x.y,20,80);A.fillText("mouse (view): "+x.v+", "+x.w,20,100);A.fillText("planet name: "+z,20,120);A.fillText("zoom: "+v,20,140);A.fillText("minerals: "+Math.floor(100*K.o)/100,20,180)};
