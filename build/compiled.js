var c=document;var aa=console.log.bind(console),k=Math.random,l=2*Math.PI;function t(a,b){return function(){a();b()}}function ba(a,b,d){var e=0;d.forEach(function(d){d.i.f==b&&(e+=l/a)});if(!(e>=l))return e}function u(a,b,d){return"hsl("+(0>a?360*k():a)+","+(0>b?100*k():b)+"%,"+(0>d?100*k():d)+"%)"};var D=function(){var a={x:0,y:0,s:0,u:0,click:!1,l:!1,release:!1,A:!1,o:!1,update:function(){a.click=!1;a.release=!1;a.o=!1;a.A=!1}};window.addEventListener("mousemove",function(b){var d=w.getBoundingClientRect();a.x=b.clientX-d.left;a.y=b.clientY-d.top;a.s=(a.x+x-w.width/2)/y;a.u=(a.y+B-w.height/2)/y;a.B&&(a.l=!0)},!1);window.addEventListener("mousedown",function(){a.click=!0;a.B=!0},!1);window.addEventListener("mouseup",function(){a.B=!1;a.l||(a.release=!0);a.l=!1},!1);window.addEventListener("mousewheel",
function(b){a.A=0<b.deltaY;a.o=0>b.deltaY},!1);return a}();var ca=[];var da="",ka=c.addEventListener.bind(c),w=c.getElementById("c"),E=w.getContext("2d"),x=0,B=0,la=0,ma=0,na=0,oa=0,pa=0,qa=0,y=1,ra=1,I=2;function sa(){if(D.o||D.A){var a=ra+(D.o?.1:-.1);ra=2<a?2:.1>a?.1:a}I=Math.min(1+(y-.1),2);D.click&&!ta.display&&(ua=!0,na=x,oa=B,pa=D.x,qa=D.y);D.l&&ua?(la=na+(pa-D.x),ma=oa+(qa-D.y)):D.release&&(ua=!1);a=y;y+=(ra-y)/5;a=y-a;.001<Math.abs(a)&&(x+=D.s*a,B+=D.u*a,la=x,ma=B);x+=(la-x)/5;B+=(ma-B)/5}function va(){E.setTransform(1,0,0,1,0,0)}
function Ba(){E.setTransform(y,0,0,y,-x+w.width/2,-B+w.height/2)}var ua;Ca();window.addEventListener("resize",Ca,!1);function Ca(){w.width=window.innerWidth;w.height=window.innerHeight;E.clearRect(0,0,w.width,w.height)}
function Da(a,b,d,e,n,f,g,r,J,C,p,z,v,m,A){void 0===r&&(r=1);void 0===z&&(z=0);void 0===v&&(v=l);void 0===m&&(m=0);void 0===A&&(A=!1);void 0===p&&(p=0);a.beginPath();a.globalAlpha=r;a[b+"Style"]=g;a.lineWidth=J/y;a.shadowColor=C;a.shadowBlur=p;a.ellipse(d,e,n,n*(f?1/I:1),m,z,v,A);a[b]()}
function Ea(a,b,d){if(!a.cache){var e=c.createElement("CANVAS");e.width=256;e.height=256;a.cache=e;e=a.cache.getContext("2d");var n=a.m?"#ffffff":a.color,f=a.m?50:10;a.m&&(e.filter="blur(4px)");Da(e,"fill",128,128,a.size,!1,n,1,0,a.color,f);if(a.i)for(f=n=a.size,e.beginPath(),e.arc(128,128,a.size,0,2*Math.PI,!1),e.clip();n--;)Da(e,"fill",128-f/2+(a.size-f)/2,128,2*f--,!1,"#000000",.05,0,"#000000",10,-l/4,l/4);e.filter="none"}e=Fa[0];e=Math.atan2((a.y-e.y)*I,a.x-e.x);E.globalAlpha=1;E.shadowBlur=0;
void 0===b&&(b=a.x);void 0===d&&(d=a.y);E.translate(b,d);E.rotate(e);a.m&&(b=1+.03*k(),E.scale(b,b));E.drawImage(a.cache,-128,-128);Ba()};var Ga=c.createElement("CANVAS");Ga.width=512;Ga.height=512;var K=Ga.getContext("2d");K.shadowBlur=1;K.globalAlpha=.5;for(var Ha=300;Ha--;){var Ia=512*Math.random(),Ja=512*Math.random(),Ka=u(-1,100,90);K.fillStyle=Ka;K.shadowColor=Ka;K.beginPath();K.arc(Ia,Ja,.5,0,2*Math.PI);K.fill()}var Ta=E.createPattern(Ga,"repeat");
function Ua(){var a=performance.now()/2E3;E.rect(0,0,w.width,w.height);E.fillStyle=Ta;E.save();E.translate(w.width/2,w.height/2);E.scale(.5,.5);E.translate(-x/25+a/2,-B/25);E.save();E.rotate(a/200);E.fill();E.restore();E.scale(2,2);E.translate(-x/25+a,-B/25);E.rotate(a/200);E.fill();E.restore()};var Fa=[],L=[],Va=[];
function M(a,b,d,e,n,f){void 0===f&&(f=0);var g={name:"Some Shithole Planet",type:"orbital",x:0,y:0};g.color=a;g.size=b;g.m=!1;d&&(g.i={f:d,j:e,speed:n,angle:f});g.update=function(){var a=D.s-g.x,b=D.u-g.y;Math.sqrt(a*a+b*b)<g.size+5&&(da=g.name,D.release&&ta.show(g));g.i&&(a=g.i,a.angle+=a.speed,g.x=a.j*Math.cos(a.angle)+a.f.x,g.y=a.j/I*Math.sin(a.angle)+a.f.y)};g.g=function(){var a=g.i;a&&(E.setLineDash([5,5]),Da(E,"stroke",a.f.x,a.f.y,a.j,!0,g.color,.3,1),E.setLineDash([]));(a=g.i)&&Da(E,"stroke",
a.f.x,a.f.y,a.j,!0,g.color,.3,3,g.color,5,a.angle-a.speed*a.j,a.angle,0,0>a.speed);Ea(g,g.x,g.y)};Fa.push(g);return g}function P(a,b,d,e,n,f){void 0===f&&(f=0);a=M(a,b,d,e+b/2,n,f);a.name=a.type="planet";a.update=t(a.update,function(){});return a}function Wa(a){void 0!==ba(Xa,a,L)&&(a=M(u(212,100,97),2,a,3*a.size,-.005),a.name=a.type="mining",a.update=t(a.update,function(){Q.w+=Q.K}))}var Xa=4;
function R(a){var b=ba(Ya,a,L);if(void 0!==b){var d=M(u(160,100,50),2,a,5*a.size,.01,b);d.name=d.type="satellite";d.index=L.length;L.push(d);d.g=t(d.g,function(){for(var a=d.index;a<L.length;a++){var b=L[a],f;if(f=b!=d){f=b.x-d.x;var g=(b.y-d.y)*I;f=Math.sqrt(f*f+g*g)<=Q.F}f&&(f=d,E.setLineDash([1,1]),E.beginPath(),E.globalAlpha=.2/y,E.moveTo(f.x,f.y),E.bezierCurveTo(f.x,f.y-50,b.x,b.y-50,b.x,b.y),E.lineWidth=1/y*2,E.strokeStyle="#00FF00",E.stroke(),E.globalAlpha=1,E.setLineDash([]))}})}}var Ya=3;
function Za(a){var b=ba($a,a,Va);void 0!==b&&(a=M(u(33,100,50),2,a,7*a.size,.005,b),a.name=a.type="defense",a.index=Va.length,Va.push(a),a.g=t(a.g,function(){}))}var $a=2;var ta=function(){var a={};ca.push(a);a.display=!1;a.v=300;a.h=400;a.target=null;a.show=function(b){D.l||ta.display||"planet"!=b.type||(a.display=!0,a.target=b)};a.update=function(){if(a.display){var b=D.x-w.width/2,d=D.y-w.height/2;D.click&&(b>-a.v/2&&b<a.v/2&&d>-a.h/2&&d<a.h/2?aa("logged menu"):(a.target=null,a.display=!1))}};a.g=function(){a.display&&(E.fillStyle="#141e28",E.fillRect(-a.v/2,-a.h/2,a.v,a.h),E.fillStyle="#ffffff",E.textAlign="center",E.font="24px monospace",E.fillText((Q.f===a.target?
"Base":"")+" "+a.target.name,0,-a.h/2+20),Ea(a.target,0,-a.h/2+100+a.target.size/2))};return a}(),Q=null,ab=new function(){function a(a){return Math.sin(6.283184*a)}var b=[a,function(a){return.5>a%1?1:-1},function(a){return a%1*2-1},function(a){a=a%1*4;return 2>a?a-1:3-a}],d,e,n,f,g;this.J=function(){var a={M:[{a:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,194,4,1,3,25,191,115,244,147,6,84,6],p:[5,1,2,1,1,1,1,3,4,1,2,1,2,1,2,,,7,8,7,8,7,8,7,8,6,9],c:[{n:[123,123,135,128,123,123,135,130,126,125,126,
128,123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130],b:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,48]},{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],b:[,,,,,,,,,,,,,,,,,,,,,,,,,,,11,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,31]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,123],b:[]},{n:[114,,,,,,,,126,,,,,,,,114,,,,,,,,114,126,111,123,114,126,118,130],b:[13,,,,,,,,,,,,,,,,,,,,,,,,13,,13,,13,
,13,11,29,,,,,,,,,,,,,,,,,,,,,,,,32,,41,,29,,25,15]},{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],b:[13,11,21,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,17,29,,25,113,,,,,,,,,,,,,,,,,,,,,,,,,,,,194]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,99],b:[]},{n:[111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111],b:[]},{n:[114,126,,126,114,,126,114,114,126,,126,114,,126,114,
114,126,,126,114,,126,114,116,128,,128,116,,114,121],b:[]},{n:[],b:[]}]},{a:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,0,0,2,14,1,1,39,76,5,0,0],p:[,1,1,1,1,1,1,2,,,,1,1,1,1,1,1,,,1,1,1,1,1,1],c:[{n:[147,,,,,,147,,,,147,,,,,,147,,,,,,147,,,,147,,,,147],b:[]},{n:[147],b:[]}]},{a:[0,0,140,0,0,0,140,0,0,60,4,10,68,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,1,1,2,3,2,3,4,,,,2,3,2,3,2,3,,,5,5,5,5,5,5,4],c:[{n:[,,,,147,,,,,,,,148,,,,,,,,147,,,,,,,,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,
,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,147,147,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,68]},{n:[147,,,147,,,147,,147,,,147,,147,,147,147,,,147,,,147,,147,,,147,,147,,147],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]}]},{a:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,0,0,136,5,1,2,8,92,21,56,148,5,85,8],p:[3,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,
2,1,2,1,2],c:[{n:[111],b:[]},{n:[114],b:[]},{n:[111],b:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,56]}]},{a:[3,0,127,0,3,68,127,0,1,218,4,4,40,0,0,1,55,4,1,2,67,115,124,190,67,6,39,1],p:[,,,1,2,1,2,3,,,,1,2,1,2,1,2,,,1,4,1,4,1,4,3],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],b:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,147,147],b:[]},{n:[147],b:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,147],b:[]}]},{a:[0,91,128,0,0,95,128,12,0,0,12,0,67,0,0,0,0,0,0,2,
255,15,0,32,83,3,134,4],p:[,,,1,2,3,2,1,2,,,1,2,3,2,1,2,,,,,4,5,4,5],c:[{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],b:[5,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,157,,162,,126],b:[]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],b:[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[159,,162,,164,,,,159,,162,164,,,162,,159,,162,,164,,,,159,,162,164,,
,162],b:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[157,,162,,164,,,,157,,162,164,,,162,,157,,162,,164,,,,157,,162,164,,,162],b:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]}]},{a:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,3,179,5,1,3,37,135,63,67,150,3,157,6],p:[,,,,,,,,,1,2,3,,1,2,1,2,3,,4,5,,,,,3],c:[{n:[123,,,,,,,,,,,,,,,,130],b:[11,24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,92,67]},{n:[133,,,,,,,,,,,,,,,138,126,,,,,,,,,,,,125],b:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,11,,,,95,,,,,,,,,,,,
,,,,,,,,,,,,,,,,29]},{n:[123],b:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,52,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,116],b:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,95]},{n:[133,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,126,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,118],b:[]}]},{a:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,16,83,5,53,1],p:[,,,,,,,1,,,,,,,,,,1,,,,,,,,1],c:[{n:[147],b:[]}]}],D:5513,C:32,H:26,L:8};d=a;e=a.H;n=0;f=a.D*a.C*(e+1)*2;g=
new Int32Array(f)};this.I=function(){var r,J,C,p,z,v=new Int32Array(f),m=d.M[n],A=d.D,ea=d.C,wa=0,fa=0,F;var G=!1;var ha=[];for(J=0;J<=e;++J){var W=m.p[J];for(C=0;C<ea;++C){if(z=W?m.c[W-1].b[C]:0)m.a[z-1]=m.c[W-1].b[C+ea]||0,16>z&&(ha=[]);var ib=b[m.a[15]],jb=m.a[16]/512,kb=Math.pow(2,m.a[17]-9)/A,lb=m.a[18],La=m.a[19],mb=135.82764118168*m.a[20]/44100,nb=1-m.a[21]/255,xa=1E-5*m.a[22],ob=m.a[23]/32,pb=m.a[24]/512,qb=6.283184*Math.pow(2,m.a[25]-9)/A,Ma=m.a[26]/255,ya=m.a[27]*A&-2;z=(J*ea+C)*A;for(p=
0;4>p;++p)if(r=W?m.c[W-1].n[C+p*ea]:0){if(!ha[r]){var h=ha;var N=r;var Na=F=void 0,ia,H,q=m,Oa=r,rb=b[q.a[0]],sb=q.a[1],tb=q.a[3],ub=b[q.a[4]],vb=q.a[5],wb=q.a[8],Pa=q.a[9],S=q.a[10]*q.a[10]*4,ja=q.a[11]*q.a[11]*4,za=q.a[12]*q.a[12]*4,xb=1/za,X=q.a[13],yb=A*Math.pow(2,2-q.a[14]),Qa=new Int32Array(S+ja+za),Ra=0,Sa=0;for(ia=H=0;H<S+ja+za;H++,ia++){0<=ia&&(X=X>>8|(X&255)<<4,ia-=yb,Na=.003959503758*Math.pow(2,(Oa+(X&15)+q.a[2]-128-128)/12),F=.003959503758*Math.pow(2,(Oa+(X&15)+q.a[6]-128-128)/12)*(1+
8E-4*q.a[7]));var O=1;H<S?O=H/S:H>=S+ja&&(O-=(H-S-ja)*xb);var Y=Na;tb&&(Y*=O*O);Ra+=Y;var Aa=rb(Ra)*sb;Y=F;wb&&(Y*=O*O);Sa+=Y;Aa+=ub(Sa)*vb;Pa&&(Aa+=(2*Math.random()-1)*Pa);Qa[H]=80*Aa*O|0}h[N]=Qa}N=ha[r];r=0;for(h=2*z;r<N.length;r++,h+=2)v[h]+=N[r]}for(r=0;r<A;r++)p=2*(z+r),(h=v[p])||G?(G=mb,lb&&(G*=ib(kb*p)*jb+.5),G=1.5*Math.sin(G),wa+=G*fa,h=nb*(h-fa)-wa,fa+=G*h,h=3==La?fa:1==La?h:wa,xa&&(h*=xa,h=1>h?-1<h?a(.25*h):-1:1,h/=xa),h*=ob,G=1E-5<h*h,N=Math.sin(qb*p)*pb+.5,F=h*(1-N),h*=N):F=0,p>=ya&&(F+=
v[p-ya+1]*Ma,h+=v[p-ya]*Ma),v[p]=F|0,v[p+1]=h|0,g[p]+=F|0,g[p+1]+=h|0}}n++;return n/d.L};this.G=function(){var a=44+2*f-8,b=a-36,d=new Uint8Array(44+2*f);d.set([82,73,70,70,a&255,a>>8&255,a>>16&255,a>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,b&255,b>>8&255,b>>16&255,b>>24&255]);a=0;for(b=44;a<f;++a){var e=g[a];e=-32767>e?-32767:32767<e?32767:e;d[b++]=e&255;d[b++]=e>>8&255}return d};this.getData=function(a,b){for(var d=2*Math.floor(44100*a),e=
Array(b),f=0;f<2*b;f+=1){var n=d+f;e[f]=0<a&&n<g.length?g[n]/32768:0}return e}};ab.J();var bb=!1;setInterval(function(){if(!bb&&(bb=1<=ab.I())){var a=ab.G(),b=document.createElement("audio");b.src=URL.createObjectURL(new Blob([a],{type:"audio/wav"}));b.play()}},0);ka("contextmenu",function(a){a.preventDefault()});var cb=u(60,100,50),T=M(cb,50,null,null,null);T.name=T.type="sun";T.m=!0;var U=P(u(180,39,62),10,T,500,.003,k()*l),V={};V.f=U;V.K=.01;V.N=300;V.O=0;V.P=0;V.F=1E3;V.w=0;Q=V;
P(u(-1,60,70),5,U,100,-.002,k()*l);var Z=P(u(-1,60,70),20,T,1123,.0015,k()*l);P(u(-1,60,70),5,Z,8*Z.size,.01,k()*l);P(u(-1,60,70),10,Z,9*Z.size,.005);P(u(-1,60,70),30,T,2532,-.001,k()*l);Wa(U);Wa(Z);R(U);R(T);R(T);R(T);R(Z);R(Z);R(Z);Za(U);Za(U);Za(U);Za(Z);var db=performance.now(),eb=1E3/60,fb=0,gb=0,hb=[];
(function zb(a){requestAnimationFrame(zb);var d=db+eb;hb.push(1/((a-fb)/1E3));fb=a;if(60<hb.length){var e=0,n=1E3,f=0;hb.shift();hb.forEach(function(a){e+=a;n=Math.min(n,a);f=Math.max(f,a)});gb=Math.floor(e/60)+", "+~~n+" - "+~~f}a>d&&(Ab(Math.min(Math.floor((a-db)/eb),60)),db=a);Bb()})(db);function Ab(a){da="";sa();ca.forEach(function(a){a.update()});Fa.forEach(function(a){a.update()});D.update();--a&&Ab(a)}
function Bb(){va();E.clearRect(0,0,w.width,w.height);E.save();E.beginPath();var a=w.width/2-x,b=w.height/2-B;a=E.createRadialGradient(a,b,0,a,b,4E3);a.addColorStop(0,"#141e28");a.addColorStop(1,"#000000");E.fillStyle=a;E.rect(0,0,w.width,w.height);E.fill();E.restore();va();Ua();Ba();Fa.forEach(function(a){a.g()});E.setTransform(1,0,0,1,w.width/2,w.height/2);ca.forEach(function(a){a.g()});va();E.font="14px monospace";E.textBaseline="top";E.textAlign="left";E.fillStyle="#ffffff";E.fillText("#js13k tower defense prototype",
20,20);E.fillText("https://github.com/scorp200/td13k",20,40);E.fillText("framerate: "+gb,20,60);E.fillText("mouse (gui): "+D.x+", "+D.y,20,80);E.fillText("mouse (view): "+D.s+", "+D.u,20,100);E.fillText("planet name: "+da,20,120);E.fillText("zoom: "+y,20,140);E.fillText("minerals: "+Math.floor(100*Q.w)/100,20,180)};
